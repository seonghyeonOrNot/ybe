name: Run Claude Subagents by Label

on:
  issues:
    types: [labeled]

permissions:
  id-token: write
  issues: write
  contents: read

jobs:
  policy_pm:
    if: github.event.label.name == 'agent:policy-pm'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the policy-pm subagent.

            Analyze the issue and produce a full policy architecture document.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}

  ux_architect:
    if: github.event.label.name == 'agent:ux-architect'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the ux-architect subagent.

            Design UX flow and interface architecture based on the issue.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}

  risk_compliance:
    if: github.event.label.name == 'agent:risk-compliance'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the risk-compliance subagent.

            Identify operational, legal, and compliance risks from the issue.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}

  qa_engineer:
    if: github.event.label.name == 'agent:qa-engineer'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the qa-engineer subagent.

            Design comprehensive test scenarios and edge cases.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}

  data_analyst:
    if: github.event.label.name == 'agent:data-analyst'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the data-analyst subagent.

            Define KPIs, tracking events, and measurement plans.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}

  tech_communicator:
    if: github.event.label.name == 'agent:tech-communicator'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          show_full_output: true
          prompt: |
            You must use the tech-communicator subagent.

            Convert the issue into technical implementation structure.

            Context:
            Title: ${{ github.event.issue.title }}
            Body:
            ${{ github.event.issue.body }}
