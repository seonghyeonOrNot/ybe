# 전자결재 시스템 기능 정의서 (Functional Specification)

## 카탈로그 참고 결과

| feature_id | 대메뉴 | 중메뉴 | 소메뉴 | 요약 |
|------------|--------|--------|--------|------|
| MOB-SCH-1 | 메인 | 오늘 출장/외근 일정 | 일정 요약 정보 | 오늘 예정된 출장과 외근의 총 건수를 상단에 노출함. |
| MOB-SCH-2 | 메인 | 오늘 출장/외근 일정 | 일정 상세 정보 | 각 일정의 제목, 시작/종료 시간, 근무지 주소 등을 카드 형태로 표시함. |
| MOB-SCH-3 | 메인 | 오늘 출장/외근 일정 | 일정 노출 제어 | X 버튼 클릭 시 해당 일정 항목을 리스트에서 즉시 숨김 처리함. |
| MOB-SCH-7 | 메인 | 오늘 출장/외근 일정 | 근무 메모 연동 | 입력한 메모는 일정에서 상세 모달 내 메모 내역 탭에서 조회/수정/삭제 가능. |
| MOB-SCH-8 | 메인 | 오늘 출장/외근 일정 | 근무지 상태 배지 | 현재 근무 장소에 따라 메인 화면 우측 상단의 배지 컬러와 텍스트가 동적으로 변경됨. |
| USR-APR-6 | 전자결재 | 기안서 작성 | 출장신청서 - 신청 시간 개별 설정 | 개별 설정 토글 활성화 시, 신청 기간의 모든 날짜가 리스트 형태로 나열되어 각 날짜별로 독립적인 시작/종료 시간 및 근무지 구분을 설정할 수 있음. |
| USR-APR-8 | 전자결재 | 기안서 작성 | 출장신청서 - 휴게 및 근무 시간 | 근로기준법에 따라 휴게 시간이 자동 계산되어 노출되며, 신청 사유는 캘린더 일정 등록 시 제목으로 사용됨. |

## 1. 목적 (Purpose)

전자결재 시스템의 목적은 다음과 같습니다:

- **업무 효율성 향상**: 출장, 외근, 재택근무, 파견, 시간외근무 등 다양한 근무 형태에 대한 신청 및 승인 프로세스를 디지털화하여 업무 효율성을 높입니다.
- **결재 내역 체계적 관리**: 모든 결재 내역을 시스템에 기록하여 추후 조회 및 분석이 가능하도록 합니다.
- **근로기준법 준수**: 휴게 시간 자동 계산 등 근로기준법을 준수하는 기능을 제공하여 법적 리스크를 최소화합니다.
- **실시간 협업 지원**: 푸시 알림 및 캘린더 자동 등록 기능을 통해 신속한 결재 프로세스와 일정 공유를 지원합니다.
- **사용자 경험 개선**: 모바일과 웹 환경 모두에서 직관적이고 편리한 UI/UX를 제공합니다.

## 2. 범위 (Scope)

### 2.1 포함 범위 (In Scope)

- **기안서 작성 기능**: 출장신청서, 재택근무신청서, 외근신청서, 파견신청서, 시간외근무신청서 작성 및 상신
- **결재 현황 조회**: 상신한 문서 및 결재할 문서 목록 조회
- **모바일 일정 관리**: 오늘 예정된 출장/외근 일정 조회, 메모 작성, 일정 숨김 처리
- **자동 계산 기능**: 휴게 시간 및 순수 근무 시간 자동 계산
- **캘린더 자동 등록**: 외근신청서, 파견신청서 신청 완료 시 사용자 캘린더에 일정 자동 등록
- **푸시 알림**: 결재 상신 시 결재선 지정자에게 푸시 알림 발송
- **권한 관리**: 일반 직원, 결재자, 관리자 권한별 접근 제어
- **근무지 상태 배지**: 현재 근무 장소에 따라 모바일 메인 화면 우측 상단의 배지 동적 변경

### 2.2 제외 범위 (Out of Scope)

- **결재선 자동 추천 기능**: 결재선은 사용자가 직접 선택하며, 자동 추천 기능은 포함되지 않음
- **결재 문서 통계 및 리포트 생성**: 관리자용 통계 및 리포트 생성 기능은 향후 추가 예정
- **결재 문서 인쇄 기능**: 결재 문서 인쇄 기능은 포함되지 않음
- **결재 문서 PDF 다운로드**: 결재 문서 PDF 다운로드 기능은 향후 추가 예정
- **결재 문서 이메일 전송**: 결재 문서 이메일 전송 기능은 푸시 알림으로 대체되며, 별도 이메일 전송 기능은 포함되지 않음 (단, 푸시 알림 발송 실패 시 대체 이메일 알림 발송)

## 3. 용어 정의 (Terminology)

| 용어 | 정의 |
|------|------|
| 전자결재 | 출장, 외근, 재택근무, 파견, 시간외근무 등 다양한 근무 형태에 대한 신청서를 디지털 방식으로 작성하고 승인하는 시스템 |
| 기안서 | 전자결재 시스템에서 사용자가 작성하는 신청서 (출장신청서, 재택근무신청서, 외근신청서, 파견신청서, 시간외근무신청서 등) |
| 상신 | 작성한 기안서를 결재선에 제출하는 행위 |
| 결재선 | 기안서를 승인 또는 반려하는 결재자들의 순서 |
| 결재자 | 기안서를 검토하고 승인 또는 반려하는 권한을 가진 사용자 |
| 개별 설정 | 신청 기간의 각 날짜별로 독립적인 시작/종료 시간 및 근무지 구분을 설정할 수 있는 기능 |
| 휴게 시간 | 근로기준법에 따라 근무 시간 중 휴식을 위해 부여되는 시간 (근무 시간 4시간당 30분, 8시간당 1시간) |
| 순수 근무 시간 | 총 근무 시간에서 휴게 시간을 제외한 실제 근무 시간 |
| 일정 자동 등록 | 외근신청서, 파견신청서 신청 완료 시 해당 일정이 사용자 캘린더(USR-SCH)에 자동으로 등록되는 기능 |
| 푸시 알림 | 결재 상신 시 결재선 지정자에게 모바일 앱을 통해 발송되는 알림 |
| 근무지 상태 배지 | 모바일 메인 화면 우측 상단에 표시되는 현재 근무 장소 상태 표시 (사무실, 재택, 파견, 출장, 미출근, 퇴근, 외근, 이동중 등) |
| 일정 숨김 처리 | 모바일 메인 화면에서 사용자가 X 버튼을 클릭하여 특정 일정을 리스트에서 숨기는 기능 |

## 4. 상태 정의 (State Definitions)

### 4.1 결재 문서 상태

| 상태 | 설명 |
|------|------|
| 임시저장 | 사용자가 기안서를 작성 중이며, 아직 상신하지 않은 상태 |
| 상신 | 사용자가 기안서를 결재선에 제출한 상태 |
| 진행중 | 결재선의 일부 결재자가 승인했으나, 최종 승인은 완료되지 않은 상태 |
| 승인 | 모든 결재자가 승인하여 결재가 완료된 상태 |
| 반려 | 결재자 중 한 명 이상이 반려하여 결재가 거부된 상태 |
| 취소 | 사용자가 상신한 기안서를 취소한 상태 |

### 4.2 일정 노출 상태

| 상태 | 설명 |
|------|------|
| 노출 | 모바일 메인 화면에서 일정이 표시되는 상태 |
| 숨김 | 사용자가 X 버튼을 클릭하여 모바일 메인 화면에서 일정을 숨긴 상태 |

### 4.3 근무지 상태

| 상태 | 설명 |
|------|------|
| 사무실 | 사용자가 사무실에서 근무 중인 상태 |
| 재택 | 사용자가 재택근무 중인 상태 |
| 파견 | 사용자가 파견 근무 중인 상태 |
| 출장 | 사용자가 출장 중인 상태 |
| 미출근 | 사용자가 아직 출근하지 않은 상태 |
| 퇴근 | 사용자가 퇴근한 상태 |
| 외근 | 사용자가 외근 중인 상태 |
| 이동중 | 사용자가 이동 중인 상태 |

## 5. 데이터 필드 (Data Fields)

### 5.1 출장신청서 데이터 필드

| 필드명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-------------|-----------|------|
| 제목 | String | 필수 | 출장 제목 |
| 신청 기간 | Date Range | 필수 | 출장 시작일 ~ 종료일 |
| 신청 시간 | Time Range | 선택 | 시작 시간 ~ 종료 시간 (여러 시간대 추가 가능) |
| 근무지 구분 | String | 선택 | 근무지 구분 (예: 본사, 지사, 고객사 등) |
| 종일일정 | Boolean | 선택 | 종일 일정 여부 (체크 시 시간 선택 비활성화) |
| 개별 설정 | Boolean | 선택 | 날짜별 개별 시간 설정 여부 |
| 휴게 시간 | Integer (분) | 자동 계산 | 근로기준법에 따라 자동 계산된 휴게 시간 |
| 상세 내용 | Rich Text | 선택 | 출장 목적, 계획 등 상세 내용 |
| 첨부 파일 | File[] | 선택 | 첨부 파일 목록 |
| 관련 문서 | Document[] | 선택 | 관련 결재 문서 목록 |
| 결재선 | User[] | 필수 | 결재자 목록 |
| 상신 일시 | DateTime | 자동 생성 | 기안서 상신 일시 |
| 작성자 | User | 자동 생성 | 기안서 작성자 |
| 결재 상태 | String | 자동 생성 | 임시저장, 상신, 진행중, 승인, 반려, 취소 |

### 5.2 재택근무신청서 데이터 필드

출장신청서와 동일한 데이터 필드를 사용합니다.

### 5.3 외근신청서 데이터 필드

| 필드명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-------------|-----------|------|
| 제목 | String | 필수 | 외근 제목 |
| 신청 기간 | Date Range | 필수 | 외근 시작일 ~ 종료일 |
| 신청 시간 | Time Range | 선택 | 시작 시간 ~ 종료 시간 |
| 상세 내용 | Rich Text | 선택 | 외근 목적, 계획 등 상세 내용 |
| 첨부 파일 | File[] | 선택 | 첨부 파일 목록 |
| 결재선 | User[] | 필수 | 결재자 목록 |
| 상신 일시 | DateTime | 자동 생성 | 기안서 상신 일시 |
| 작성자 | User | 자동 생성 | 기안서 작성자 |
| 결재 상태 | String | 자동 생성 | 임시저장, 상신, 진행중, 승인, 반려, 취소 |
| 캘린더 등록 여부 | Boolean | 자동 생성 | 일정 자동 등록 성공 여부 |

### 5.4 파견신청서 데이터 필드

외근신청서와 동일한 데이터 필드를 사용합니다.

### 5.5 시간외근무신청서 데이터 필드

| 필드명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-------------|-----------|------|
| 제목 | String | 필수 | 시간외근무 제목 |
| 근무 날짜 | Date | 필수 | 근무 날짜 |
| 근무 시작 시간 | Time | 필수 | 근무 시작 시간 (시, 분) |
| 근무 종료 시간 | Time | 필수 | 근무 종료 시간 (시, 분) |
| 휴일 여부 | Boolean | 선택 | 휴일 근무 여부 |
| 휴게 시간 | Integer (분) | 선택 | 휴게 시간 (분) |
| 순수 근무 시간 | Integer (분) | 자동 계산 | (근무 종료 - 근무 시작) - 총 휴게시간 |
| 상세 내용 | Rich Text | 선택 | 시간외근무 사유 등 상세 내용 |
| 첨부 파일 | File[] | 선택 | 첨부 파일 목록 |
| 결재선 | User[] | 필수 | 결재자 목록 |
| 상신 일시 | DateTime | 자동 생성 | 기안서 상신 일시 |
| 작성자 | User | 자동 생성 | 기안서 작성자 |
| 결재 상태 | String | 자동 생성 | 임시저장, 상신, 진행중, 승인, 반려, 취소 |

### 5.6 일정 메모 데이터 필드

| 필드명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-------------|-----------|------|
| 일정 ID | String | 필수 | 메모가 연결된 일정의 ID |
| 메모 내용 | Text | 필수 | 메모 내용 |
| 작성자 | User | 자동 생성 | 메모 작성자 |
| 작성 일시 | DateTime | 자동 생성 | 메모 작성 일시 |
| 수정 일시 | DateTime | 자동 생성 | 메모 수정 일시 |

## 6. 권한 (Permissions)

### 6.1 일반 직원 권한

- 기안서 작성 및 상신 (출장, 외근, 재택, 파견, 시간외근무)
- 본인이 작성한 기안서 조회 및 취소
- 모바일에서 본인의 오늘 일정 조회 및 메모 작성
- 근무지 상태 배지 확인

### 6.2 결재자 권한

- 일반 직원 권한 포함
- 결재선에 포함된 기안서 조회 및 승인/반려
- 결재 현황 조회 (본인이 결재선에 포함된 기안서만)

### 6.3 관리자 권한

- 일반 직원 및 결재자 권한 포함
- 전체 결재 현황 조회
- 통계 및 리포트 생성 (향후 추가 예정)

## 7. 에러 처리 (Error Handling)

| 에러 코드 | 에러 메시지 | 설명 | 처리 방법 |
|-----------|-------------|------|-----------|
| E-001 | 제목은 필수 입력 항목입니다 | 기안서 제목이 입력되지 않은 경우 | 사용자에게 오류 메시지 표시 및 입력 요청 |
| E-002 | 종료 시간은 시작 시간보다 늦어야 합니다 | 시간외근무신청서에서 종료 시간이 시작 시간보다 빠른 경우 | 사용자에게 오류 메시지 표시 및 재입력 요청 |
| E-003 | 신청 기간을 변경하면 입력한 내용이 초기화될 수 있습니다. 계속하시겠습니까? | 일정 변경 시 데이터 초기화 경고 | 경고 메시지 표시 및 사용자 확인 대기 |
| E-004 | 일정 자동 등록에 실패했습니다. 캘린더에서 수동으로 일정을 등록해주세요 | 캘린더 연동 API 실패 | 오류 메시지 표시 및 수동 등록 안내, 재시도 로직 실행 |
| E-005 | 관련 문서가 없습니다 | 관련 결재 문서 검색 결과가 없는 경우 | 안내 문구 표시 |
| E-006 | 오늘 예정된 출장/외근 일정이 없습니다 | 모바일에서 오늘 일정이 없는 경우 | 안내 문구 표시 |
| E-007 | 푸시 알림 발송에 실패했습니다 | 푸시 알림 발송 실패 | 시스템 로그 기록 및 이메일 알림 대체 발송 |
| E-008 | 파일 크기가 너무 크거나 지원되지 않는 형식입니다 | 파일 첨부 실패 | 오류 메시지 표시 및 파일 재선택 요청 |
| E-009 | 메모 저장에 실패했습니다. 다시 시도해주세요 | 메모 저장 실패 | 오류 메시지 표시 및 재시도 안내 |
| E-010 | 입력 가능한 단어 수를 초과했습니다 (현재: X단어, 최대: Y단어) | 리치 텍스트 에디터 입력 제한 초과 | 경고 메시지 표시 및 추가 입력 차단 |
| E-011 | 권한이 없습니다. 본인이 작성한 기안서만 조회할 수 있습니다 | 일반 직원이 다른 직원의 기안서 접근 시도 | 오류 메시지 표시 및 접근 차단 |
| E-012 | 권한이 없습니다. 결재선에 포함된 기안서만 조회할 수 있습니다 | 결재자가 결재선에 포함되지 않은 기안서 접근 시도 | 오류 메시지 표시 및 접근 차단 |

## 8. 로깅 (Logging)

### 8.1 로그 기록 대상

| 로그 유형 | 로그 내용 | 로그 레벨 |
|-----------|-----------|-----------|
| 기안서 작성 | 사용자 ID, 기안서 유형, 작성 일시, 제목 | INFO |
| 기안서 상신 | 사용자 ID, 기안서 ID, 상신 일시, 결재선 정보 | INFO |
| 결재 승인 | 결재자 ID, 기안서 ID, 승인 일시 | INFO |
| 결재 반려 | 결재자 ID, 기안서 ID, 반려 일시, 반려 사유 | INFO |
| 일정 자동 등록 성공 | 사용자 ID, 기안서 ID, 일정 등록 일시 | INFO |
| 일정 자동 등록 실패 | 사용자 ID, 기안서 ID, 실패 일시, 실패 사유 | ERROR |
| 푸시 알림 발송 성공 | 수신자 ID, 기안서 ID, 알림 발송 일시 | INFO |
| 푸시 알림 발송 실패 | 수신자 ID, 기안서 ID, 실패 일시, 실패 사유 | ERROR |
| 일정 숨김 처리 | 사용자 ID, 일정 ID, 숨김 처리 일시 | INFO |
| 권한 오류 | 사용자 ID, 요청 URL, 오류 일시, 오류 사유 | WARNING |
| 데이터 유효성 검사 실패 | 사용자 ID, 입력 데이터, 실패 일시, 실패 사유 | WARNING |

### 8.2 로그 보관 정책

- 모든 로그는 최소 1년간 보관합니다.
- INFO 레벨 로그는 1년 후 자동 삭제됩니다.
- WARNING 및 ERROR 레벨 로그는 3년간 보관합니다.
- 분쟁 발생 시 증거 자료로 활용될 수 있으므로, 로그 데이터는 안전하게 보관합니다.

## 9. 수용 기준 (Acceptance Criteria)

### AC-001: 출장신청서 작성 및 상신
- 사용자가 웹 환경에서 출장신청서를 작성하고 상신하면, 기안서가 정상적으로 저장되고 결재선 지정자에게 푸시 알림이 발송되어야 함

### AC-002: 휴게 시간 자동 계산
- 출장신청서 또는 재택근무신청서 작성 시 근무 시간이 4시간일 경우 휴게 시간이 자동으로 30분으로 계산되어 표시되어야 함
- 근무 시간이 8시간일 경우 휴게 시간이 자동으로 1시간으로 계산되어 표시되어야 함

### AC-003: 개별 설정 기능
- 출장신청서 또는 재택근무신청서 작성 시 '개별 설정' 토글을 활성화하면, 신청 기간의 모든 날짜가 리스트 형태로 나열되어야 함
- 각 날짜별로 독립적인 시작/종료 시간 및 근무지 구분을 설정할 수 있어야 함

### AC-004: 종일일정 기능
- 출장신청서 작성 시 '종일일정' 체크박스를 선택하면, 시작/종료 시간 선택 필드가 비활성화되어야 함

### AC-005: 여러 시간대 추가
- 출장신청서 작성 시 '+ 추가' 버튼을 클릭하면, 여러 시간대를 등록할 수 있어야 함
- 각 시간대는 리스트 형태로 표시되며, 개별적으로 수정/삭제할 수 있어야 함

### AC-006: 외근신청서 일정 자동 등록
- 외근신청서를 상신하면, 해당 일정이 사용자 캘린더(USR-SCH)에 자동으로 등록되어야 함
- 일정 자동 등록 실패 시 오류 메시지가 표시되어야 함

### AC-007: 파견신청서 일정 자동 등록
- 파견신청서를 상신하면, 해당 일정이 사용자 캘린더(USR-SCH)에 자동으로 등록되어야 함
- 일정 자동 등록 실패 시 오류 메시지가 표시되어야 함

### AC-008: 시간외근무신청서 순수 근무 시간 자동 계산
- 시간외근무신청서 작성 시 근무 시작 시간, 근무 종료 시간, 휴게 시간을 입력하면, 순수 근무시간이 실시간으로 자동 계산되어 표시되어야 함
- 계산 공식: 순수 근무시간 = (근무 종료 - 근무 시작) - 총 휴게시간

### AC-009: 시간외근무신청서 종료 시간 유효성 검사
- 시간외근무신청서 작성 시 종료 시간이 시작 시간보다 빠르면, "종료 시간은 시작 시간보다 늦어야 합니다"라는 오류 메시지가 표시되고 입력이 차단되어야 함

### AC-010: 모바일 - 오늘 출장/외근 일정 조회
- 모바일 메인 화면에서 오늘 예정된 출장/외근 일정의 총 건수가 상단에 표시되어야 함
- 각 일정은 카드 형태로 제목, 시작/종료 시간, 근무지 주소 등이 표시되어야 함

### AC-011: 모바일 - 일정 상세 정보 조회 및 메모 작성
- 모바일 메인 화면에서 일정 카드를 클릭하면, 일정 상세 모달이 열려야 함
- 상세 모달의 메모 내역 탭에서 메모를 작성, 조회, 수정, 삭제할 수 있어야 함

### AC-012: 모바일 - 일정 숨김 처리
- 모바일 메인 화면에서 일정 카드의 X 버튼을 클릭하면, 해당 일정이 리스트에서 즉시 숨김 처리되어야 함

### AC-013: 모바일 - 일정 페이징 처리
- 모바일 메인 화면에서 등록된 일정이 3개를 초과하면, 페이징 처리를 통해 화면 길이를 조절해야 함

### AC-014: 모바일 - 근무지 상태 배지
- 모바일 메인 화면 우측 상단에 현재 근무 장소에 따라 배지 컬러와 텍스트가 동적으로 변경되어야 함
- 지원되는 근무 상태: 사무실, 재택, 파견, 출장, 미출근, 퇴근, 외근, 이동중

### AC-015: 푸시 알림 발송
- 결재 상신 시 결재선 지정자에게 푸시 알림이 즉시 발송되어야 함
- 푸시 알림 발송 실패 시 시스템 로그에 기록되고, 이메일 알림이 대체 발송되어야 함

### AC-016: 일정 변경 시 데이터 초기화 경고
- 출장신청서 작성 중 신청 기간을 변경하면, "신청 기간을 변경하면 입력한 내용이 초기화될 수 있습니다. 계속하시겠습니까?"라는 경고 메시지가 표시되어야 함
- 사용자가 확인하면 데이터가 초기화되어야 함

### AC-017: 권한별 접근 제어 - 일반 직원
- 일반 직원은 본인이 작성한 기안서만 조회할 수 있어야 함
- 다른 직원의 기안서 접근 시도 시 "권한이 없습니다"라는 오류 메시지가 표시되고 접근이 차단되어야 함

### AC-018: 권한별 접근 제어 - 결재자
- 결재자는 본인이 결재선에 포함된 기안서만 조회하고 승인/반려할 수 있어야 함
- 결재선에 포함되지 않은 기안서 접근 시도 시 "권한이 없습니다"라는 오류 메시지가 표시되고 접근이 차단되어야 함

### AC-019: 권한별 접근 제어 - 관리자
- 관리자는 전체 조직의 결재 현황을 조회할 수 있어야 함

### AC-020: 신청 사유 캘린더 제목 자동 연동
- 출장신청서의 신청 사유는 캘린더 일정 등록 시 제목으로 자동 설정되어야 함

## 10. 관련 링크

- **Notion 페이지**: [전자결재 시스템 상세 스펙](https://www.notion.so/2f8c0f61d0748052913bc2a5b8e51439)
- **Spec ID**: TSK1-YBE2
- **카탈로그 파일**: data/catalog/features.csv
- **관련 기능**: MOB-SCH-1~8 (모바일 출장/외근 일정), USR-APR-4~32 (전자결재 기안서 작성)

## 변경점

| 항목 | 카탈로그 | 이슈 |
|------|----------|------|
| 일정 변경 시 데이터 초기화 | 명시되지 않음 | 일정 변경 시 기존 데이터가 초기화되며, AC-016에서 경고 메시지 표시 수용 기준 추가 |
| 푸시 알림 기능 | USR-APR-16에서 "결재 상신 시 결재선 지정자에게 푸시 알림 발송"이라고 명시 | 이슈에서 "푸시 알림 기능이 포함되어 있습니다"라고 명시 - 일치함. AC-015에서 푸시 알림 발송 수용 기준 추가 |
| 전자결재 등록 시 유연한 설정 | USR-APR-6, USR-APR-14에서 개별 설정 토글을 통해 각 날짜별로 독립적인 시작/종료 시간 및 근무지 구분을 설정 가능 | 이슈에서 "전자결재 등록 시 유연한 설정이 가능"이라고 명시 - 일치함. AC-003에서 개별 설정 기능 수용 기준 추가 |
| 상세 일정 및 메모 내역 확인 | MOB-SCH-7에서 입력한 메모는 일정 상세 모달 내 메모 내역 탭에서 조회/수정/삭제 가능 | 이슈에서 "상세 일정 및 메모 내역 확인 기능도 지원합니다"라고 명시 - 일치함. AC-011에서 메모 작성 수용 기준 추가 |
