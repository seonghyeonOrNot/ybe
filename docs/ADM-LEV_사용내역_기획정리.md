# ADM-LEV-20~23 연차/휴가 사용 내역 — 기획 정리

> 작성일: 2026-02-17 (최종 수정: 2026-02-18)
> 기준 데이터: features.csv ADM-LEV-7 ~ ADM-LEV-23
> 프로토타입: [prototype/leave-usage-history.html](../prototype/leave-usage-history.html)

---

## 1. 화면 구성 개요

| 구분 | Feature ID | 영역 | 설명 |
|------|-----------|------|------|
| 필터 | ADM-LEV-20 | 기간 및 상세 필터 | 기간, 승인 상태, 휴가 형태, 신청자 형태 |
| 필터 | ADM-LEV-21 | 조직도 필터 | 부서별/개인별 트리 선택 |
| 리스트 | ADM-LEV-22 | 기본 정보 컬럼 | 부서명, 구성원명, 직위/직책, 사용일, 연차 유형 |
| 리스트 | ADM-LEV-23 | 연차 상세 컬럼 | 상세, 사용단위, 사용 일수, 사용 시간, 결재 상태, 비고 |

---

## 2. 필터 영역 데이터 항목

### 2-1. 기간 및 상세 필터 (ADM-LEV-20)

| 필터 항목 | 데이터 타입 | 선택지(Enum) | 기본값 | 비고 |
|----------|-----------|-------------|-------|------|
| `period_start` | `Date` | — | 당월 1일 | 시작일 |
| `period_end` | `Date` | — | 당월 말일 | 종료일 |
| `approval_status` | `Enum` | 전체 / 확정 / 대기중 / 취소&반려 | 전체 | ADM-LEV-23 결재 상태 참조 |
| `leave_type` | `Enum` | 전체 / 연차 / 반차 / 반반차 / 시간차 / 특별휴가 | 전체 | 휴가 형태 |
| `applicant_type` | `Enum` | 전체 / 본인신청 / 관리자대리 | 전체 | 신청자 형태 |

### 2-2. 조직도 필터 (ADM-LEV-21)

| 필터 항목 | 데이터 타입 | 설명 | 비고 |
|----------|-----------|------|------|
| `org_department_ids` | `Array<string>` | 선택된 부서 ID 목록 | 트리 구조, 다중 선택 |
| `org_member_ids` | `Array<string>` | 선택된 개인 ID 목록 | 부서 하위 구성원 선택 |

### 2-3. 키워드 검색 (ADM-LEV-14 참조)

| 필터 항목 | 데이터 타입 | 설명 | 비고 |
|----------|-----------|------|------|
| `keyword` | `string` | 구성원명/부서명 부분 일치 | 입력 즉시 필터링 또는 엔터 |

---

## 3. 리스트 테이블 컬럼 정의

### 3-1. 기본 정보 (ADM-LEV-22)

| # | 컬럼명 | 필드명 | 데이터 타입 | 정렬 | 설명 |
|---|-------|--------|-----------|------|------|
| 1 | 부서명 | `department_name` | `string` | O | 소속 부서 |
| 2 | 구성원명 | `member_name` | `string` | O | 성명 |
| 3 | 직위/직책 | `position_title` | `string` | O | 직위 또는 직책명 |
| 4 | 사용일 | `used_date` | `Date` | O | 휴가 사용 날짜 (YYYY-MM-DD) |
| 5 | 연차 유형 | `leave_category` | `string` | O | ADM-LEV-13 등록 유형 |

### 3-2. 연차 관련 정보 (ADM-LEV-23)

| # | 컬럼명 | 필드명 | 데이터 타입 | 선택지(Enum) | 설명 |
|---|-------|--------|-----------|-------------|------|
| 6 | 상세 | `leave_detail` | `Enum` | 1년 미만 연차 / 비례 연차 / 기본 연차 / 이월 연차 / 대상 휴가 / 비대상 휴가 | 연차 발생 근거 구분 |
| 7 | 사용단위 | `usage_unit` | `Enum` | 종일 / 반차 / 반반차 / 시간 | 근로자 사용 휴가 단위 |
| 8 | 사용 일수 | `used_days` | `Decimal` | — | 일수 환산값 (1 / 0.5 / 0.25 / 0.125) |
| 9 | 사용 시간 | `used_hours` | `string` | — | 시간 환산값 (예: "8시간 0분", "4시간 0분") |
| 10 | 결재 상태 | `approval_status` | `Enum` | 확정 / 취소&반려 / 대기중 | 결재 진행 상태 |
| 11 | 비고 | `remark` | `string` | — | 사유 또는 관리자 메모 |

---

## 4. 사용단위별 환산 기준표

| 사용단위 | `usage_unit` | `used_days` | `used_hours` (8h 기준) |
|---------|-------------|-------------|----------------------|
| 종일 | `FULL_DAY` | 1 | 8시간 0분 |
| 반차(오전) | `HALF_DAY_AM` | 0.5 | 4시간 0분 |
| 반차(오후) | `HALF_DAY_PM` | 0.5 | 4시간 0분 |
| 반반차 | `QUARTER_DAY` | 0.25 | 2시간 0분 |
| 시간 | `HOURLY` | 0.125 (1h 기준) | N시간 N분 |

---

## 5. 결재 상태 배지 정의

| 상태값 | `approval_status` | 배지 색상 | 설명 |
|-------|-------------------|----------|------|
| 확정 | `APPROVED` | Blue/Green | 결재 완료 |
| 대기중 | `PENDING` | Yellow | 결재 진행 중 |
| 취소&반려 | `REJECTED` | Red | 취소 또는 반려 처리 |

---

## 6. API 데이터 모델

### Response

```
LeaveUsageRecord {
  record_id          : string
  member_id          : string
  department_name    : string
  member_name        : string
  position_title     : string
  used_date          : Date
  leave_category     : string
  leave_detail       : Enum    // 1년미만연차|비례연차|기본연차|이월연차|대상휴가|비대상휴가
  usage_unit         : Enum    // FULL_DAY|HALF_DAY_AM|HALF_DAY_PM|QUARTER_DAY|HOURLY
  used_days          : Decimal
  used_hours         : string
  approval_status    : Enum    // APPROVED|PENDING|REJECTED
  remark             : string | null
  applicant_type     : Enum    // SELF|ADMIN_PROXY
  created_at         : DateTime
}
```

### Request (필터)

```
LeaveUsageFilter {
  period_start       : Date
  period_end         : Date
  approval_status    : Enum | null
  leave_type         : Enum | null
  applicant_type     : Enum | null
  org_department_ids : Array<string>
  org_member_ids     : Array<string>
  keyword            : string | null
  page               : int
  page_size          : int
  sort_field         : string | null
  sort_order         : Enum          // ASC | DESC
}
```

---

## 7. 연차 현황(ADM-LEV-14~19)과의 정합성 검증

| 연차 현황 항목 (ADM-LEV-17) | 사용 내역과의 관계 | 검증 산식 |
|---------------------------|-----------------|----------|
| 총 발생연차 | 사용 내역 합산의 모수 | — |
| 사용연차 | 확정 건 합산 | `SUM(used_days) WHERE status='APPROVED'` |
| 잔여연차 | 총 발생 - 사용 | 정합성 체크 대상 |
| 이월연차 | 이월 건만 필터 | `leave_detail = '이월연차'` |
| 조정연차 | 관리자 수동 조정 (ADM-LEV-18) | 사용 내역에 미포함 |
| 소멸연차 | 소멸 처리된 잔여분 | 사용 내역에 미포함 |

---

## 8. 사용자(USR) vs 관리자(ADM) 화면 대비

| 항목 | 사용자 (USR-SCH-9/10) | 관리자 (ADM-LEV-20~23) | 차이 |
|------|---------------------|---------------------|------|
| 필터 | 상태 탭 (전체/진행/완료/반려/취소) | 기간+상태+휴가형태+신청자형태+조직도 | 관리자 다중 필터 |
| 결재상태 | O | O | 동일 |
| 사용일 | O | O | 동일 |
| 휴가형태 | O | 연차 유형 + 상세 | 관리자 2단계 분류 |
| 사용일수 | O | 사용단위 + 사용일수 + 사용시간 | 관리자 3항목 분리 |
| 사유 | O | 비고 | 동일 역할 |
| 신청일 | O | — (추가 권장) | 관리자 미노출 |
| 부서/직위 | — | O | 관리자 전용 |
| 조직도 필터 | — | O | 관리자 전용 |
| 엑셀 내보내기 | — | ADM-ATT-8 패턴 적용 가능 | 관리자 전용 |

---

## 9. PM 추가 고려사항

### 9-1. 기능 누락 항목

| # | 누락 영역 | 필요 사항 | 근거 |
|---|----------|----------|------|
| 1 | 엑셀 다운로드 | 필터 적용 상태 그대로 내보내기 | ADM-ATT-8에 근태현황 내보내기 존재 |
| 2 | 신청일 컬럼 | 사용일과 신청일 차이 = 사후 신청 추적 | USR-SCH-10에는 신청일 존재 |
| 3 | 취소/반려 사유 | 반려자명 + 반려 사유 별도 표시 | 결재 프로세스 추적 |
| 4 | 합계 행 | 테이블 하단 총 사용일수/시간 합산 | 관리자 집계 리포트 용도 |
| 5 | 연차 외 휴가 포함 여부 | 경조사/출산/병가 등 특별휴가 표시 범위 | ADM-LEV-8에 "연차외 휴가" 존재 |

### 9-2. 정책 미확정 사항

| # | 정책 질문 | 가정안 | PM 결정 필요 |
|---|----------|-------|-------------|
| 1 | 취소&반려 건 기본 노출 여부 | 기본값 "전체"로 노출, 확정 건과 시각 구분 | 가독성 영향 |
| 2 | 기간 필터 기준 (사용일 vs 신청일) | 사용일 기준 | 사후 신청 건 주의 |
| 3 | 연차 당겨쓰기 건 표시 방식 | leave_detail에 "당겨쓰기" 추가 | 선사용 건 구분 필요 |
| 4 | 관리자 대리 신청 건 표시 | 리스트에 아이콘/태그 표시 | 필터만 있고 리스트 미반영 |
| 5 | 반차 오전/오후 구분 | HALF_DAY_AM / HALF_DAY_PM 분리 | 현재 "반차"만 정의 |
| 6 | 소수점 연차 표시 정밀도 | 소수점 3자리 (0.125) | 회사별 설정 가능 |

### 9-3. UX/UI 개선 고려

| # | 영역 | 개선안 | 우선순위 |
|---|------|-------|---------|
| 1 | 빈 상태(Empty State) | 필터 결과 0건 시 안내 + 초기화 버튼 | 높음 |
| 2 | 날짜 범위 연속 사용 | 2/10~2/12 연차 = 1건 범위 표시 vs 3건 개별 | 높음 |
| 3 | 정렬 기본값 | 사용일 DESC (최신순) | 중간 |
| 4 | 페이지네이션 | 페이지네이션 (엑셀 내보내기와 일관성) | 중간 |
| 5 | 구성원 클릭 연계 | 연차 현황(ADM-LEV-19) 상세 모달 연결 | 높음 |
| 6 | 필터 칩 표시 | 적용 조건 칩 + 개별 해제 | 중간 |

### 9-4. 타 서비스 벤치마크 갭

| 기능 | 플렉스(FLEX) | 시프티(Shiftee) | 현재 스펙 | 갭 |
|------|------------|----------------|----------|-----|
| 일괄 취소 | O | O | X | 다건 선택 후 일괄 취소 없음 |
| 인쇄 | O | — | X | 프린트용 레이아웃 미고려 |
| 대리 신청 표시 | 아이콘 구분 | 신청자 컬럼 | 필터만 존재 | 리스트 시각 구분 불가 |
| 월별/부서별 통계 | 대시보드 | 차트 | X | 집계 시각화 없음 |

### 9-5. 단계별 출시 제안

| Phase | 범위 | 포함 | 제외 |
|-------|------|------|------|
| Phase 1 (MVP) | 기본 조회 | 필터, 테이블 11컬럼, 페이지네이션, 정렬 | 엑셀, 통계, 일괄취소 |
| Phase 2 | 운영 효율 | 엑셀 다운로드, 합계행, 필터칩, 빈상태, 반차 오전/오후 | 통계 대시보드 |
| Phase 3 | 고도화 | 통계 차트, 일괄 취소, 촉진 대상자 표시, 결재 이력 | — |

---

## 10. PM 최종 체크리스트

| # | 확인 사항 | 상태 | 담당 |
|---|----------|------|------|
| 1 | 기간 필터 기준 확정 (사용일 vs 신청일) | 미확정 | PM |
| 2 | 반차 오전/오후 Enum 분리 여부 | 미확정 | PM |
| 3 | 날짜 범위 연속 사용 시 행 표시 방식 | 미확정 | PM + UX |
| 4 | 연차 외 특별휴가 포함 범위 | 미확정 | PM + 정책 |
| 5 | 당겨쓰기 건 표시 정책 | 미확정 | PM + 정책 |
| 6 | 엑셀 내보내기 Phase 확정 | 미확정 | PM |
| 7 | 취소 건 잔여연차 원복 시점 | 미확정 | PM + 개발 |
| 8 | 구성원 클릭 -> 연차 현황 연계 | 미확정 | PM + UX |
| 9 | 관리자 대리 신청 리스트 표시 방식 | 미확정 | PM + UX |
| 10 | 신청일 컬럼 추가 여부 | 미확정 | PM |
| 11 | 시간 단위 연차의 최소 사용 단위 (1분/10분/30분/60분) | 미확정 | PM |
| 12 | 잔여 연차 표시 포맷 (시간:분 vs 일수 vs 둘 다) | 미확정 | PM + UX |
| 13 | 소정근로시간 변경 시 기존 연차 재계산 정책 | 미확정 | PM + 정책 |

---

## 11. 시간 단위 연차 환산 설계 (ADM-LEV-7 연계)

> 소정근로시간이 8시간이 아닌 경우(7시간, 3시간 등) "일" 단위 환산 시 무한소수가 발생한다.
> 이를 해결하기 위해 **분(minute) 정수를 단일 원장**으로 사용한다.

### 11-1. 문제 정의

| 소정근로시간 | 종일(1일) | 반차(0.5일) | 반반차(0.25일) | 1시간 | 1분 |
|------------|----------|-----------|-------------|------|-----|
| **8시간** (480분) | 480분 | 240분 | 120분 | 0.125일 | 0.002083일 |
| **7시간** (420분) | 420분 | 210분 | 105분 | 0.142857일... | 0.002380일... |
| **3시간** (180분) | 180분 | 90분 | 45분 | 0.333...일 | 0.005555일... |

7시간, 3시간 근로자는 **무한소수**가 발생 → "일" 단위로 정밀한 표현 불가능

### 11-2. 설계 원칙: 분(minute) 기준 단일 원장

| 원칙 | 설명 |
|------|------|
| **저장 기준** | 모든 연차를 **분(minute) 정수**로 저장 (내부 원장) |
| **환산 공식** | `사용일수 = 사용분 / 소정근로분` (표시용 계산) |
| **정밀도** | 분 단위는 정수이므로 오차 없음 |
| **표시** | 사용자에게는 **시간:분 + 일수** 두 가지를 동시 노출 |

```
[핵심 산식]

총 발생 연차(분) = 발생일수 x 소정근로시간(분)
잔여 연차(분)   = 총 발생(분) - 사용(분) - 소멸(분) + 조정(분)
사용 일수(표시) = 사용(분) / 소정근로시간(분)   ← 표시용, 반올림 적용
```

### 11-3. 소정근로시간별 환산표

#### 8시간 근로자 (480분/일)

| 사용 형태 | 사용 분 | 사용 일수 | 표시 |
|----------|--------|----------|------|
| 종일 | 480분 | 1.000일 | 1일 (8시간 0분) |
| 반차 | 240분 | 0.500일 | 0.5일 (4시간 0분) |
| 반반차 | 120분 | 0.250일 | 0.25일 (2시간 0분) |
| 1시간 | 60분 | 0.125일 | 0.125일 (1시간 0분) |
| 30분 | 30분 | 0.063일 | 0.063일 (0시간 30분) |

#### 7시간 근로자 (420분/일)

| 사용 형태 | 사용 분 | 사용 일수 (원본) | 사용 일수 (반올림) | 표시 |
|----------|--------|----------------|-----------------|------|
| 종일 | 420분 | 1.000000 | 1.000일 | 1일 (7시간 0분) |
| 반차 | 210분 | 0.500000 | 0.500일 | 0.5일 (3시간 30분) |
| 반반차 | 105분 | 0.250000 | 0.250일 | 0.25일 (1시간 45분) |
| 1시간 | 60분 | 0.142857 | **0.143일** | 0.143일 (1시간 0분) |
| 30분 | 30분 | 0.071428 | **0.071일** | 0.071일 (0시간 30분) |

#### 3시간 근로자 (180분/일) — 단시간 근로

| 사용 형태 | 사용 분 | 사용 일수 (원본) | 사용 일수 (반올림) | 표시 |
|----------|--------|----------------|-----------------|------|
| 종일 | 180분 | 1.000000 | 1.000일 | 1일 (3시간 0분) |
| 반차 | 90분 | 0.500000 | 0.500일 | 0.5일 (1시간 30분) |
| 1시간 | 60분 | 0.333333 | **0.333일** | 0.333일 (1시간 0분) |
| 30분 | 30분 | 0.166666 | **0.167일** | 0.167일 (0시간 30분) |
| 1분 | 1분 | 0.005555 | **0.006일** | 0.006일 (0시간 1분) |

### 11-4. 반올림 정책과 누적 오차 방지

#### 문제

```
7시간 근로자가 1시간씩 7번 사용:
  반올림 합산: 0.143 x 7 = 1.001일  (실제: 정확히 1일)
  → 0.001일 초과 오차 발생
```

#### 해결: "분 원장 기준 계산, 표시만 환산"

| 방식 | 설명 | 오차 |
|------|------|------|
| X 행별 반올림 후 합산 | 매 건 0.143일로 저장 후 합산 | 누적 오차 발생 |
| **O 분 합산 후 최종 환산** | 60분 x 7 = 420분 → 420/420 = 1.000일 | **오차 없음** |

```
[올바른 계산 흐름]

1. 각 사용 건: 분(정수)으로 저장         ← 원장
2. 잔여 연차: 분 단위로 합산/차감        ← 연산
3. 표시용 일수: 최종 합산분 / 소정근로분  ← 표시 (이 시점에만 반올림)
```

### 11-5. 사용자 UI 표시 설계

#### 잔여 연차 카드 (USR-SCH-6 연계)

```
┌─────────────────────────────────────────────┐
│  나의 연차 현황                    2026년     │
│                                              │
│  총 발생        사용          잔여            │
│  15일           6일 3시간     8일 4시간 30분  │
│  (6,300분)     (2,580분)     (3,720분)       │
│                                              │
│  ████████████████░░░░░░░░░  41% 사용         │
│                                              │
│  소정근로시간: 7시간/일                        │
└─────────────────────────────────────────────┘
```

핵심: **"일 + 시간 + 분"** 3단위 표시 + 괄호 안에 총 분 표시

#### 잔여 연차 표시 포맷 (소정근로시간별)

| 소정근로시간 | 잔여 3,720분 표시 | 비고 |
|------------|-----------------|------|
| 8시간 (480분) | **7일 6시간 0분** (7.750일) | 깔끔하게 나눠짐 |
| 7시간 (420분) | **8일 6시간 0분** (8.857일) | 시:분까지 표시 필요 |
| 3시간 (180분) | **20일 2시간 0분** (20.667일) | 일수가 많아 보임 |

```
[환산 공식]

잔여분 = 3720
일   = 잔여분 ÷ 소정근로분 (정수 몫)   → 3720 ÷ 420 = 8
남은분 = 잔여분 % 소정근로분             → 3720 % 420 = 360
시간  = 남은분 ÷ 60 (정수 몫)           → 360 ÷ 60 = 6
분   = 남은분 % 60                      → 360 % 60 = 0
→ 표시: "8일 6시간 0분"
```

### 11-6. 데이터 모델 수정안 (분 기반)

#### LeaveUsageRecord (수정)

```
LeaveUsageRecord {
  ...기존 필드...

  used_minutes       : int       // 원장 (정수, 오차 없음)
  used_hours_display : string    // 표시용 "1시간 30분"
  used_days_display  : Decimal   // 표시용 반올림 (소수점 3자리)
}
```

#### MemberLeaveConfig (신규)

```
MemberLeaveConfig {
  member_id                 : string
  prescribed_daily_minutes  : int      // 소정근로시간 (분) — 480, 420, 180 등
  min_usage_unit_minutes    : int      // 최소 사용 단위 (분) — 1, 30, 60 등
}
```

#### LeaveSummary (신규)

```
LeaveSummary {
  total_granted_minutes  : int    // 총 발생 (분)
  total_used_minutes     : int    // 총 사용 (분)
  total_adjusted_minutes : int    // 조정 (분)
  total_expired_minutes  : int    // 소멸 (분)
  remaining_minutes      : int    // 잔여 (분) = 발생 - 사용 - 소멸 + 조정

  // 표시용
  remaining_display      : string  // "8일 6시간 0분"
  remaining_days_display : Decimal // 8.857
  usage_rate_percent     : int     // 41
}
```

### 11-7. PM 결정 필요 사항

| # | 질문 | 선택지 | 영향 |
|---|------|-------|------|
| 1 | **최소 사용 단위** | 1분 / 10분 / 30분 / 60분 | 1분 허용 시 UX 복잡도 증가, 관리 부담 |
| 2 | **일수 표시 반올림** | 소수점 2자리 / 3자리 / 미표시 | 3자리 권장 (0.143), 2자리면 오차 커짐 |
| 3 | **1차 표시 기준** | 시간:분 우선 / 일수 우선 | 시간:분 우선 권장 (정확한 값) |
| 4 | **잔여 연차 포맷** | "8일 4시간 30분" / "8.857일" / 둘 다 | 둘 다 표시 권장 |
| 5 | **소정근로시간 변경 시** | 변경 시점 기준 재계산 / 기존분 유지 | 분 원장이면 재계산 용이 |
